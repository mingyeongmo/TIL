# 세션

---

## 📌 세션의 특징

세션 아이디는 웹 브라우저 당 1개씩 생성되어 웹 컨테이너에 저장되며 브라우저 종료시 소멸됩니다.
로그인한 사용자에 대해서만 세션을 생성하는 것이 아니라 로그아웃하면 새로운 사용자로 인식해서 새로운 세션이 생성됩니다.
(참고로 쿠키는 내 웹브라우저에 저장된 것이기 때문에 로그아웃 유무와 관계없이 삭제하지 않으면 유지 됩니다.)

아이디, 닉네임 등의 정보를 세션에 담아두면 요청이 있을 때 마다, DB에 접근할 필요가 없어서 효율적입니다.
쿠키와 세션을 활용해 사용자를 확인하는 방식을 도식화해보자면 다음과 같습니다.
![도식화](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FZQfRh%2FbtqBUAkkVFJ%2FSvwcSFcUcX4pgwkQHT6ab0%2Fimg.png)

> 1. 서버에서는 사용자로부터 요청이 있을 때 사용자를 구분하기 위한 임시쿠키 하나를 보내 저장하도록 한다.
> 2. 저장된 쿠키는 웹 브라우저의 쿠키저장소에 저장된다.
> 3. 이후 같은 사이트의 서버를 방문할 때마다, 저장된 쿠키를 요청할 header에 담아 함께 다시 서버로 전송한다.
>    서버는 전송받은 쿠키와 서버에 저장된 사용자 정보를 비교하여 같은 사용자임을 확인한다.

## 📌 세션(Session) 사용하기

세션의 속성 설정하기 : session 객체의 setAttribute() 메소드 사용

`session.setAttribute("id","value");`

session 객체의 setAttribute() 메소드를 사용해서 세션의 속성을 지정하게 되면 계속 상태를 유지하는 기능을 사용할 수 있게 됩니다.

세션의 속성을 사용하기: session 객체의 getAttribute() 메소드

`String id = (String)session.getAttribute("id");`

단, getAttribute() 메소드는 리턴 타입이 Object 타입이므로 사용 시 실제 할당된 객체 타입으로 형변환(casting)을 해야 합니다!

세션의 속성 삭제하기: session 객체의 removeAttribute() 메소드

`session.removeAttribute("id");`

세션의 모든 속성 삭제: session 객체의 invalidate() 메소드

`session.invalidate();`

마지막으로 쿠키와 세션을 비교해보자면,

|          |                         Cookie                          |    Session    |
| :------: | :-----------------------------------------------------: | :-----------: |
| 저장위치 |                       클라이언트                        |     서버      |
| 저장형식 |                          text                           |    Object     |
|  리소스  |                   클라이언트의 리소스                   | 서버의 리소스 |
| 용량제한 |               도메인당 20개, 1쿠키당 4KB                |   제한 없음   |
| 만료시점 | 쿠키 저장시 설정(설정 없을 시에는 브라우저 종료시 만료) |  알 수 없음   |

1. 저장위치

- 클라이언트의 웹 브라우저가 쩡하는 메모리 또는 하드디스크에 저장 (단, 쿠키를 허용하지 않은 경우에는 저장되지 않습니다.)
- 세션 : 서버의 메모리에 저장

2. 저장형식

- 쿠키 : text 형식으로 저장
- 세션 : Object 형식으로 저장

3. 리소스(사용되는 자원)

- 쿠키 : 클라이언트에 저장되고 클라이언트의 메모리를 사용하기 때문에 서버의 자원을 사용하지 않음
- 세션 : 세션은 서버에 저장되고 서버의 메모리로 로딩이 되기 때문에 세션이 생길때마다 서버의 리소스를 차지

4. 용량제한

- 쿠키 클라이언트도 모르게 접속되는 사이트에 의하여 설정될 수 있기 때문에 쿠키로 인해 문제가 발생하는 것을 막고자 한 도메인당 20개 /하나의 쿠키 당 4KB로 제한
- 세션 : 갯수나 용량에 제한이 없음

5. 만료시점

- 쿠키 : 저장할 때 expires 속성을 정의해 무효화 시키면 삭제될 날짜를 지정할 수 있음(따로 지정되지 않은 경우에는 브라우저 종료시 만료)
- 세션 : 클라이언트가 로그아웃하거나, 설정한 시간동안 반응이 없을경우 무효화 되기 때문에 정확한 시점을 알 수 없음

## 💡 간단요약

![쿠키와세션비교](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fc1UC0j%2FbtqBJ7qtIpt%2Fk1b6Pw2heFR9fbesfWeY01%2Fimg.png)

쿠키는 자동완성이나, 팝업 일주일간 보지 않기 등 사용자의 편의를 위하는 것이지만 지워져도 되고, 조작되거나 가로채이더라도 큰 지장이 없는 수준의 정보들을 저장하는데 사용됩니다.

그리고 사용자나 다른 누군가에게 노출되면 안되는 중요한 정보들은 세션으로 서버안에서 다뤄집니다.

쿠키로 노칠시켜서는 안될 정보들이 있고, 세션을 남발하면 서버에 부담이 되어 과ㅜ하가 일어나기 때문에 웹을 설계할 때는 이 정보는 쿠키에 저장할 지 세션에 저장할 지 적절한 판단을 내릴 수 있어야 합니다.
