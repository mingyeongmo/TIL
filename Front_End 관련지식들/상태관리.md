# 프론트엔드 개발에서의 상태 관리

---

React가 상태관리를 위한 라이브러리는 아니다.

그러나 상태 관리의 주요 원칙을 배우고 이를 따라간다면, 컴포넌트 간 서로 느슨하게 결합된(loose coupled), 구조적으로 아름다운 코드를 작성할 수 있다.

## 상태

상태는 변하는 데이터

특별히 UI, 프론트엔드 개발에서는 "동적으로 표현되는 데이터"이다.

![상태의 예시](https://media.vlpt.us/images/ehdgusdl9177/post/8adfb3f6-90f9-4853-8444-b255d0e7895b/_2021-07-07__5.29.48.png)

## Side Effect

함수 (또는 컴포넌트)의 입력 외에도 함수의 결과에 영향을 미치는 요인

대표적인 예: 네트워크 요청(백엔드 API 요청)

## Side Effect를 최대한 배제하고 컴포넌트를 만들어라

![](https://media.vlpt.us/images/ehdgusdl9177/post/622ed74a-067c-4014-803d-b489317a9fd2/_2021-07-07__5.36.56.png)

만약 그림과 같이 컴포넌트를 만든다면, fetch와 같은 API 요청이 없어도 이 컴포넌트는 작동해야한다.

어떤 데이터가 들어오는지 상관하지 않고, 설사 데이터가 가짜 데이터라 할지라도 컴포넌트는 표현(presentation) 그 자체에 집중하는 것이다.

## 불가피한 Side Effect와 상태

![](https://media.vlpt.us/images/ehdgusdl9177/post/24fa9f01-1208-4190-ad12-81ae015efb42/_2021-07-07__5.49.31.png)

예를 들어 그림과 같이 "로딩중"을 나타낼 것인지 아닌지 여부는 데이터 전송 여부에 따라 달려있다.

## 상태의 두가지 구분

![상태의 두가지 구분](https://media.vlpt.us/images/ehdgusdl9177/post/f1f979d4-4aba-40e8-ae5d-004c87f2882a/_2021-07-07__6.40.04.png)

로컬 상태는 특정 컴포넌트 안에서만 관리되는 상태이며, 전역 상태는 프로덕트 전체 혹은 여러가지 컴포넌트가 동시에 관리하는 상태를 말한다.

## 로컬 상태

특정 컴포넌트 안에서만 관리되는 상태

![로컬상태](https://media.vlpt.us/images/ehdgusdl9177/post/efb6bfff-1cc5-400e-8fb9-5704e1e06f2c/_2021-07-07__6.43.03.png)

보통 컴포넌트 내에서만 영향을끼치는 상태는 로컬 상태이다.

컴포넌트의 경우, "선택한 수량"이 된다.

원래 가격에 상태를 곱해 컴포넌트 내에 표시되는 주문 금액을 업데이트 하면 된다.

다른 컴포넌트와 데이터를 공유하지 않는 폼(form) 데이터는 대부분 로컬 상태이다.

input box, select box 등과 같이 입력값을 받는 경우가 이에 해당한다.

## 전역 상태

프로덕트 전체 혹은 여러 컴포넌트에서 관리되는 상태

![전역상태](https://media.vlpt.us/images/ehdgusdl9177/post/7864dce1-ad67-4a4f-9b7a-6d2424e3a7f8/_2021-07-07__6.46.38.png)

전역 상태는 다른 컴포넌트와 상태를 공유하고 영향을 끼치는 상태이다.

장바구니에 담긴 물품의 경우, 상품 선택 여부에 따라 총 주문 금액을 업데이트해야 한다.

장바구니에 담긴 물품은 그 갯수 등을 다른 컴포넌트에 전달해주어야 한다.

![](https://media.vlpt.us/images/ehdgusdl9177/post/f2bea86e-3b8f-4e01-ae42-3983f7b58b13/_2021-07-07__6.51.14.png)

전역 변수를 남용하는 것은 좋지 않다고 배웠지만 경우에 따라 전역 상태가 필요하다.

서로 다른 컴포넌트가 사용하는 상태의 종류가 다르면, 꼭 전역 상태일 필요는 없다.

출처(source)가 달라도 된다.

그러나, 서로 다른 컴포넌트가 동일한 상태를 다룬다면, 이 출처는 오직 한 곳이어야 한다.

만일 사본이 있을 경우, 두 데이터는 서로 동기화(sync)하는 과정이 필요한데, 이는 문제를 어렵게 만든다.

한 곳에서만 상태를 저장하고 접근하라.

여기서 '하나의 출처'는 다른 말로 이야기하면 '전역 공간'이라고 볼 수 있다.

## 전역 상태에서의 데이터 무결성

데이터 무결성이란?

데이터의 정확성을 보장하기 위해 데이터의 변경이나 수정 시 제한을 두어 안정성을 저해하는 요소를 막고 데이터 상태들을 항상 옳게 유지하는 것

![무결성을 위한 방법론](https://media.vlpt.us/images/ehdgusdl9177/post/f15391fc-cdd2-46ee-b82d-b326e18391e4/_2021-07-07__6.59.40.png)

Single source of truth : 신뢰할 수 있는 단일 출처

## 전역 상태 관리

![전역상태관리](https://media.vlpt.us/images/ehdgusdl9177/post/30d87531-2940-4bf9-8b40-9fb3bf900b3e/_2021-07-07__7.02.18.png)

이 경우 모든 페이지, 모든 컴포넌트에 다크 모드 혹은 라이트 모드가 적용이 되어야 하기 때문에 이러한 테마 설정을 전역으로 관리할 수도 있다.

(Globalization 설정(언어 바꾸기), Undo/Redo를 위한 History 기능 등 또한 전역 상태 관리)

## 상태 관리를 위한 각종 툴

- React Context
- Redux
- MobX

**상태 관리 툴은 보통 어떤 문제를 해결해줄까?**

- 전역 상태 저장소 제공
  ![전역 상태 저장소 제공](https://media.vlpt.us/images/ehdgusdl9177/post/2a94c9c9-4ec3-4123-a7c6-44667fee463f/_2021-07-07__7.11.02.png)
- Props drilling 이슈 해결
