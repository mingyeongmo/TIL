# JSON Web Token 이 뭘까?

---

## JWT란?

### 정의

Json Web Token의 약자로 Json 객체를 사용하여 가볍고 **자가수용적인**(self-contined) 방식으로 정보를 안정성있게 전달하기 위한 방법이다.

### 제공되는 언어

C, Java, Python, C++ 등의 **많은 언어**에서 지원된다.

### 자가 수용적이란??

토큰의 **기본정보**, **전달할 정보**, **인증**까지 자기 자신이 지니고 있음을 뜻한다. 이를 어려운 말로 자가수용적이라 하는것!

### 전달방법

HTTP 통신에서 헤더, URL 파라미터 (쿼리), body등의 **다양한 방식**으로 전달 가능하다.

## 그래서 JWT 언제써야하지?

### 회원인증

서버는 유저가 로그인에 성공하게 되면 토큰을 유저에게 발급해주고 이후에 유저가 서버에 글을 요청할 때마다 토큰이 유효하고 인증되었는지 검증 후에 작업을 처리한다.

### 정보교류

예를 들어, 사용자 email을 URL의 파라미터로 전달하게 된다면 이는 안정성이 떨어지는 방법이다. **JWT**를 이용한다면 안정성있게 데이터를 전달하여 정보교류가 가능하다.

## 그래서 왜 써야 하지?

### 서버 기반 인증의 단점을 보완

서버의 메모리, 데이터베이스 등에 세션을 저장하고 이를 인증의 기능으로 하는 것을 서버 기반 인증이라 하는데 서버 기반 인증은 **세션의 수가 증가함에 따라 과부하**가 걸릴 가능성이 존재하며 여러 개의 서버 컴퓨터를 분산적으로 사용한다고 해도 **세션이 생성되어있는 서버 컴퓨터에서만 인증의 기능을 사용할 수 밖에 없기 때문에 확장성이 떨어진다.** 또한, 세션을 관리 할 때 사용되는 쿠키는 단일 도메인 및 서브도메인에서만 작동하도록 설계 되어 있기 때문에 **CORS 문제**가 발생할 수 있다.

### 무상태와 확장성

서버 기반 인증과 다르게 세션을 서버에 저장하지 않기 때문에 **Stateless**(server side에 client와 server의 동작, 상태정보를 저장하지 않는 형태) 한 상태를 유지할 수 잇으며 서버의 **확장성**을 높일 수 있다.

### Extensibility

로그인 정보(혹은 사용자 정보)가 사용되는 분야의 확장성을 높일 수 있다.

### CORS

토큰이 유효하다면 어떤 도메인이나 포트, 디바이스에서도 요청이 정상적으로 처리 될 수 있다.

## JWT의 생김새

![JWT의 생김새](https://miro.medium.com/max/1400/1*XJJygmigKAWmcI3oZ-YL6A.png)

JWT는 .을 구분자로 3가지 문자열로 구성되있으며 이는 각각 헤더, 내용, 서명으로 이루어져 있다.

### 헤더(Header)

헤더는 다음 2가지 정보를 가진다.

typ: 토큰의 정류

alg : 해싱 알고리즘. 보통 HMAC SH256 혹은 RSA

```
{
    "typ" : "JWT",
    "alg" : "HS256"
}
```

### 내용(Payload)

내용에는 토큰을 담을 정보가 들어가게 된다. 여기서 정보의 한 조각을 **클레임(Claim)**이라고 부르며, name/value 한쌍으로 이루어진다.

**등록된 클레임**

- iss : 토큰 발급자
- sub : 토큰 제목
- aud : 토큰 대상자
- exp : 만료시간
- nbf : Not Before를 의미. 이 날짜가 지나기 전까지 토큰의 처리를 허용안함.
- iat : 토큰의 발급 시간
- jti : JWT의 고유 식별자

**공개 클레임**

```
{
    "https://smlee.com/jwt_claims/is_admin" : true
}
```

**비공개 클레임**

```
{
    "username" : "smlee"
}
```

### 서명(Signature)

헤더와 내용을 base64로 **인코딩** 한 것이다. 또한, 이를 헤더에서 지정한 해싱 알고리즘을 이용하여 **해싱**을 하면 **서명**이 생성된다.
